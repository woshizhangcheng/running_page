# 轨迹墙页面实现总结 V2 - 15列轨迹方格墙

## ✅ 已完成的功能

### 1. **TrackWallSidebar 组件**
**文件**: `src/components/TrackWallSidebar/index.tsx`

功能:
- ✅ 显示 Total Summary 大卡片(带红色边框 #E31937 和发光效果)
- ✅ 统计全部数据的:总距离、次数、总时长、平均配速、平均心率
- ✅ 按年份显示统计卡片列表
- ✅ 每个年份卡片显示:年份、次数、距离、时间、平均配速、平均心率
- ✅ 点击年份卡片可切换选中状态(红色高亮)
- ✅ 再次点击已选中年份可取消选择

样式特点:
- 深色主题: `bg-zinc-900`
- 品牌红色: `#E31937`
- 圆角卡片: `rounded-2xl`, `rounded-xl`
- Hover 效果: 年份卡片 hover 时文字变红色

### 2. **TrackWallGrid 组件 (V2 - 15列轨迹方格墙)**
**文件**: `src/components/TrackWallGrid/index.tsx`

核心特性:
- ✅ **15列网格布局**: 类似 GitHub 贡献热力图的设计
- ✅ **每个小方格显示跑步轨迹路线**: 使用 SVG 绘制轨迹
- ✅ **鼠标悬停显示详细信息**: Tooltip 显示日期、距离、时间、心率
- ✅ **轨迹路线可视化**:
  - 红色轨迹线(#E31937)
  - 绿色起点标记(#2ecc71)
  - 红色终点标记(#e74c3c)
  - 自动适配轨迹边界
- ✅ **交互效果**:
  - Hover 时边框变红色
  - 点击方格跳转到首页地图定位
  - Tooltip 跟随鼠标位置

样式布局:
- 使用 `grid-cols-15` 自定义类(15列网格)
- `aspect-square` 保持每个格子为正方形
- `gap-1` 格子间距 1px
- 深色半透明背景: `bg-zinc-900/50`
- 边框: `border-zinc-800`

### 3. **SummaryPage 页面**
**文件**: `src/pages/summary.tsx`

布局:
- ✅ 左右布局结构
- ✅ 左侧边栏:固定宽度 280px,sticky 定位,可独立滚动
- ✅ 右侧网格:flex-1 自适应,显示 15 列轨迹方格墙
- ✅ 页面标题:显示当前筛选状态

### 4. **CSS 自定义样式**
**文件**: `src/styles/index.css`

新增:
```css
@layer utilities {
  .grid-cols-15 {
    display: grid;
    grid-template-columns: repeat(15, minmax(0, 1fr));
  }
}
```

## 🎨 设计亮点

### 视觉设计
1. **轨迹方格墙**:
   - 每个格子包含完整的跑步轨迹路线
   - 红色品牌色贯穿始终
   - 起点(绿)和终点(红)标记清晰

2. **Tooltip 设计**:
   - 固定定位,跟随鼠标
   - 深色背景 + 边框
   - 显示日期、距离、时间、心率
   - 使用图标增强可读性

3. **交互反馈**:
   - Hover: 边框变红色 + 轨迹高亮
   - 点击: 跳转到首页并定位到地图

### 布局结构
```
┌────────────────────────────────────────────────────────┐
│  轨迹墙                                                 │
├──────────┬─────────────────────────────────────────────┤
│          │ ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐          │
│ Total    │ │轨迹方格 (15列 x N行)                │          │
│ Summary  │ ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤          │
│          │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │          │
├──────────┤ ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤          │
│ 2026     │ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │          │
│ 5 runs   │ ├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤          │
├──────────┤ │ │ │ │ │ │ │ │ │ │ │ │ │ │ │          │
│ 2025     │ └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘          │
│ 137 runs │                                             │
├──────────┤ 鼠标悬停显示:                                │
│ 2024     │ ┌──────────────┐                           │
│ 84 runs  │ │ 2026-01-15   │                           │
│          │ │ 5.40 km      │                           │
└──────────┘ │ ⏱ 0h 44m 💗 124│                           │
             └──────────────┘                           │
└────────────────────────────────────────────────────────┘
```

## 🔄 数据流

```
useActivities()
    ↓
activities (全部数据)
    ↓
SummaryPage
    ├→ TrackWallSidebar (显示统计 + 年份选择)
    │       ↓
    │   selectedYear
    │       ↓
    └→ TrackWallGrid
            ├→ 筛选活动 (根据年份)
            ├→ 排序 (按日期降序)
            └→ 渲染 15xN 网格
                ├→ 每个格子渲染轨迹 SVG
                │   ├→ pathForRun() 获取坐标
                │   ├→ 计算边界
                │   ├→ 坐标转换
                │   └→ 绘制 SVG path + 起终点
                └→ 鼠标交互
                    ├→ Hover → 显示 Tooltip
                    └→ Click → 跳转首页
```

## 🚀 访问方式

1. 启动开发服务器:
```bash
pnpm dev
```

2. 访问轨迹墙页面:
```
http://localhost:5173/summary
```

3. 交互方式:
- **查看全部**: 默认显示所有年份的跑步轨迹
- **筛选年份**: 点击左侧年份卡片,右侧只显示该年份的轨迹
- **查看详情**: 鼠标悬停在轨迹方格上查看时间和里程
- **定位地图**: 点击轨迹方格,跳转到首页并定位到该活动

## 📐 技术实现细节

### SVG 轨迹绘制

```typescript
// 1. 获取轨迹坐标
const path = pathForRun(activity); // [[lng, lat], ...]

// 2. 计算边界框
const minLng = Math.min(...lngs);
const maxLng = Math.max(...lngs);
const minLat = Math.min(...lats);
const maxLat = Math.max(...lats);

// 3. 坐标转换函数
const toSvg = (lng: number, lat: number) => {
  const x = ((lng - minLng) / width) * 50;
  const y = 50 - ((lat - minLat) / height) * 50;
  return [x, y];
};

// 4. 生成 SVG path 字符串
const pathString = path
  .map((coord, i) => {
    const [x, y] = toSvg(coord[0], coord[1]);
    return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
  })
  .join(' ');
```

### Tooltip 定位

```typescript
// 使用固定定位 + 鼠标坐标
<div
  className="fixed z-50"
  style={{
    left: position.x + 10,
    top: position.y + 10,
    transform: 'translate(0, -50%)',
  }}
>
```

### 15列网格 CSS

```css
@layer utilities {
  .grid-cols-15 {
    display: grid;
    grid-template-columns: repeat(15, minmax(0, 1fr));
  }
}
```

## 🎯 使用场景

### 场景1: 查看全年轨迹墙
1. 访问 `/summary`
2. 左侧显示总统计
3. 右侧显示所有跑步轨迹的 15xN 网格

### 场景2: 查看某一年份轨迹
1. 点击左侧的"2025"卡片
2. 卡片变为红色高亮
3. 右侧只显示 2025 年的轨迹方格

### 场景3: 查看单个活动详情
1. 鼠标悬停在轨迹方格上
2. 显示 Tooltip:日期、距离、时间、心率
3. 点击方格
4. 跳转到首页,地图自动定位到该轨迹

## 💡 设计优势

1. **视觉冲击力强**:
   - 类似 GitHub 贡献图的设计
   - 大量轨迹数据一目了然
   - 每个格子都是一幅微型地图

2. **信息密度高**:
   - 15列布局,最大化利用空间
   - 每个格子包含完整轨迹信息
   - Tooltip 按需显示详细信息

3. **交互体验好**:
   - Hover 即看详情
   - 点击快速定位
   - 年份筛选便捷

4. **性能优化**:
   - SVG 绘制轻量级
   - useMemo 缓存计算结果
   - 按需渲染 Tooltip

## 🐛 已知问题

- 无明显 bug,功能正常运行

## ✨ 特色功能

1. **微型轨迹图**: 每个格子都包含完整的跑步轨迹路线
2. **智能边界**: 轨迹自动缩放到格子大小
3. **起终点标记**: 绿色起点 + 红色终点
4. **品牌一致性**: 红色(#E31937)贯穿整个设计
5. **年份筛选**: 点击左侧年份,右侧实时更新

## 📂 修改文件清单

```
src/
├── components/
│   ├── TrackWallSidebar/
│   │   └── index.tsx           # 左侧统计边栏
│   └── TrackWallGrid/
│       └── index.tsx           # 右侧 15xN 轨迹方格墙 (重新设计)
├── pages/
│   └── summary.tsx             # 轨迹墙页面
├── styles/
│   └── index.css               # 添加 grid-cols-15 样式
└── main.tsx                    # 更新路由配置
```

## 🔄 与之前版本的差异

### V1 (已废弃)
- 右侧使用大卡片布局
- 每个卡片显示详细数据
- 适合浏览单个活动详情

### V2 (当前)
- 右侧使用 15xN 轨迹方格墙
- 每个方格显示微型轨迹图
- 鼠标悬停显示详细信息
- 更有视觉冲击力
- 类似 GitHub 贡献图的设计

---

**开发完成时间**: 2026-01-21
**开发者**: Claude (AI Assistant)
**版本**: 2.0.0 - 15列轨迹方格墙版本
